@model Marketplace.ViewModels.FormViewModel;

<div class="container g-3">
    @using (@Html.BeginForm("Save", "Home", FormMethod.Post, new { @enctype="multipart/form-data"}))
    {
        @Html.ValidationSummary()

        <h2 class="ms-2 mt-3"> Publica un anunt </h2>
        <div class="card bg-white mt-2 border-0 border-round">
            <div class="mx-3 my-3" >
                <label> Titlu </label>
                
                <div class="col-12 col-md-6">
                    @Html.TextBoxFor(m=>m.Anunt.Title, new { @class="form-control background", @Id ="titleInput" })
                    @Html.ValidationMessageFor( m=>m.Anunt.Title )
                </div>
                
                <label class="mt-2"> Categorie </label>
                <div class="col-12 col-md-4">
                    @Html.DropDownListFor(m=>m.Anunt.Category, new SelectList(new List<string>()), "Categorie", new { @class = "form-control background", @Id = "categorieDropDown" })
                    @Html.ValidationMessageFor( m=>m.Anunt.Category )
                </div>
            </div>
        </div>

        <div class="card bg-white mt-2 border-0 border-round">
            <div class="mx-3 my-3">
                <label> Imagine </label>
                <input type="file" name="file" id="imageInput" onchange="photoChanged()">
                <img class="imagePreview" style="width: 300px; height: 300px" src="" id="imagePreview" >   
                <!-- To do... -->
            
            </div>
        </div>

        <div class="card bg-white mt-2 border-0 border-round">
            <div class="mx-3 my-3">
                <label> Descriere </label>
                @Html.TextAreaFor( m=>m.Anunt.Description, new { @class = "form-control background description", @placeholder = "Incearca sa scrii ceea ce ai vrea tu sa aflii daca te-ai uita la acest anunt", @name="description" }  )
                @Html.ValidationMessageFor( m=>m.Anunt.Description )
            </div>
        </div>
        
        <div class="card bg-white mt-2 border-0 border-round">
            <div class="mx-3 my-3">
                <label> Pret </label>
                <div class="row">
                    <div class="col-6">
                        @Html.TextBoxFor( m=>m.Anunt.Price, new { @class="form-control background" } )
                        @Html.ValidationMessageFor( m=>m.Anunt.Price )
                    </div>
                </div>
            </div>
        </div>
        

        <div class="card bg-white mt-2 border-0 border-round">
            <div class="mx-3 my-3">
                <div class="row">
                    <label> Locatie </label>
                    <div class="col-12 col-md-6 mb-2">
                        @Html.DropDownListFor(m=>m.Anunt.County, new SelectList(@Model.Counties.ToList()), "Alege Judetul", new { @class="form-control background", @Id="countyDropDown", @name="county" })
                        @Html.ValidationMessageFor( m=>m.Anunt.County )
                    </div>
                    <div class="col-12 col-md-6">
                        @Html.DropDownListFor( m=> m.Anunt.City, new SelectList(@Model.Counties.ToList()), "Alege Oras/Localitate", new { @class = "form-control disabled background", @Id = "cityDropDown", @name="city" })
                        @Html.ValidationMessageFor( m=>m.Anunt.City )
                    </div>
                </div>
                
            </div>
        </div>

        <div class="card bg-white mt-2 border-0 border-round">
            <div class="mx-3 my-3">
                <label> Date personale </label>
                <div class="row">
                    <div class="col-12 col-md-6 mb-2">
                        @Html.TextBoxFor( m=>m.Anunt.Mail, new { @class="form-control background", @placeholder="Mail"})
                        @Html.ValidationMessageFor( m=>m.Anunt.Mail )
                    </div>
                
                    <div class="col-12 col-md-6">
                        @Html.TextBoxFor( m=>m.Anunt.NumarTelefon, new { @class="form-control background" } )
                        @Html.ValidationMessageFor( m=>m.Anunt.NumarTelefon )
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card bg-white my-2 border-0 border-round">
                 <div class="mx-3 my-3">
                    <button id="formButton" class="btn btn-custom text-white formButton" onclick="submitForms()"> Publica un anunt </button>
                </div>
        </div>
        
        @Html.HiddenFor(m=>m.Anunt.Image)
        @Html.HiddenFor(m=>m.Anunt.Id)
    
        @Html.AntiForgeryToken();
    }
</div>


@section Scripts
{
    <script>

        function photoChanged()
        {
            var input = document.getElementById("imageInput");
            var imagePreview = document.getElementById("imagePreview");
            
            const [file] = input.files
            
            if ( file )
            {
                imagePreview.src = URL.createObjectURL(file)
            }
        }

        $(document).ready( function()
        {
            var countyDropDown = $("#countyDropDown");
            var cityDropDown = $("#cityDropDown");
            var categorieDropDown = $("#categorieDropDown");
            cityDropDown.empty();

            $.get("/api/categories", function(data)
            {
                $.each(data, function(index)
                {
                    categorieDropDown.append("<option>" + data[index] + "</option>");
                })
            });

            countyDropDown.change( function()
            {
                var url1 = "http://localhost:5064/api/location/GetAuto/" + countyDropDown.val();
                $.get(url1, function(data)
                {
                    var auto = String(data);

                    cityDropDown.empty();
                    var url = "http://localhost:5064/api/location/cities/" + auto;
                    $.get(url, function(data)
                    {
                        $.each(data, function(city)
                        {
                            cityDropDown.append("<option> " + data[city] + " </option>")
                        })

                    });

                });
                
            } )
        });
    </script>
}